(()=>{var e={};e.id=618,e.ids=[618],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),r(7270),r(9966),r(5866);var s=r(3191),t=r(8716),l=r(7922),i=r.n(l),n=r(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(a,o);let c=["",{children:["qualifications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7270)),"C:\\Users\\w10\\Documents\\GitHub\\ReponedorNUAM\\frontend\\src\\app\\qualifications\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9966)),"C:\\Users\\w10\\Documents\\GitHub\\ReponedorNUAM\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\w10\\Documents\\GitHub\\ReponedorNUAM\\frontend\\src\\app\\qualifications\\page.tsx"],m="/qualifications/page",u={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/qualifications/page",pathname:"/qualifications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8758:(e,a,r)=>{Promise.resolve().then(r.bind(r,4887))},4887:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>u});var s=r(326),t=r(7577),l=r(9837),i=r(9175),n=r(5329),o=r(3566);let c={DRAFT:{label:"Borrador",color:"bg-gray-100 text-gray-800"},PENDING:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},APPROVED:{label:"Aprobada",color:"bg-green-100 text-green-800"},REJECTED:{label:"Rechazada",color:"bg-red-100 text-red-800"},EXPIRED:{label:"Expirada",color:"bg-orange-100 text-orange-800"}};function d({qualifications:e,onAddNew:a,onView:r,onEdit:d,onDelete:m,onApprove:u,onReject:x,isLoading:h=!1}){let[p,g]=(0,t.useState)(""),[f,b]=(0,t.useState)(""),[j,y]=(0,t.useState)(""),[v,N]=(0,t.useState)(""),w=e.filter(e=>{let a=e.emisorName.toLowerCase().includes(p.toLowerCase())||e.taxId&&e.taxId.toLowerCase().includes(p.toLowerCase()),r=!f||e.country===f,s=!j||e.status===j,t=!v||e.period===v;return a&&r&&s&&t}),C=[...new Set(e.map(e=>e.period))].sort().reverse();return h?s.jsx(n.Zb,{className:"p-6",children:s.jsx("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Cargando calificaciones tributarias..."})]})})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calificaciones Tributarias"}),(0,s.jsxs)("p",{className:"text-gray-600 mt-1",children:[w.length," calificaciones encontradas"]})]}),s.jsx(l.z,{onClick:a,children:"+ Nueva Calificaci\xf3n"})]}),s.jsx(n.Zb,{className:"p-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),s.jsx(i.I,{type:"text",placeholder:"Buscar por emisor o ID tributario...",value:p,onChange:e=>g(e.target.value)})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pa\xeds"}),(0,s.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Todos los pa\xedses"}),Object.values(o.od).map(e=>(0,s.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),(0,s.jsxs)("select",{value:j,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),Object.entries(c).map(([e,{label:a}])=>s.jsx("option",{value:e,children:a},e))]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per\xedodo"}),(0,s.jsxs)("select",{value:v,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Todos los per\xedodos"}),C.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]})}),0===w.length?(0,s.jsxs)(n.Zb,{className:"p-12 text-center",children:[s.jsx("div",{className:"text-gray-400 mb-4",children:s.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay calificaciones tributarias registradas"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Comienza creando tu primera calificaci\xf3n tributaria."}),s.jsx(l.z,{onClick:a,children:"+ Crear Primera Calificaci\xf3n"})]}):s.jsx("div",{className:"space-y-4",children:w.map(e=>{let a=o.od[e.country],t=c[e.status];return s.jsx(n.Zb,{className:"p-6 hover:shadow-lg transition-shadow",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.emisorName}),s.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?.color}`,children:t?.label})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-4",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-medium",children:"Pa\xeds:"}),(0,s.jsxs)("div",{className:"flex items-center mt-1",children:[a?.flag," ",s.jsx("span",{className:"ml-1",children:a?.name})]})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-medium",children:"Per\xedodo:"}),s.jsx("p",{className:"mt-1",children:e.period})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-medium",children:"ID Tributario:"}),s.jsx("p",{className:"mt-1",children:e.taxId||"No especificado"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Monto Original:"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-gray-900 mt-1",children:[e.amount.toLocaleString()," ",e.currency]})]}),e.calculatedValue&&(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[s.jsx("span",{className:"font-medium text-blue-700",children:"Valor Calculado:"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-blue-900 mt-1",children:[e.calculatedValue.toFixed(6)," ",a?.factor]})]})]}),e.observations&&(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"Observaciones:"}),s.jsx("p",{className:"text-gray-600 text-sm mt-1",children:e.observations})]}),e.rejectionReason&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[s.jsx("span",{className:"font-medium text-red-700 text-sm",children:"Motivo de Rechazo:"}),s.jsx("p",{className:"text-red-600 text-sm mt-1",children:e.rejectionReason})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-4",children:["Creado: ",new Date(e.createdAt).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),e.user&&(0,s.jsxs)("span",{className:"ml-2",children:["por ",e.user.name]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-2 lg:ml-6",children:["PENDING"===e.status&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(l.z,{size:"sm",variant:"primary",onClick:()=>u(e),children:"Aprobar"}),s.jsx(l.z,{size:"sm",variant:"danger",onClick:()=>x(e),children:"Rechazar"})]}),s.jsx(l.z,{size:"sm",variant:"secondary",onClick:()=>r(e),children:"Ver"}),"DRAFT"===e.status&&s.jsx(l.z,{size:"sm",variant:"secondary",onClick:()=>d(e),children:"Editar"}),s.jsx(l.z,{size:"sm",variant:"danger",onClick:()=>m(e),children:"Eliminar"})]})]})},e.id)})})]})}function m({onSubmit:e,onCancel:a,isLoading:r=!1}){let[c,d]=(0,t.useState)({emisorName:"",taxId:"",country:"",period:"",amount:"",currency:"USD",observations:"",documentUrl:""}),[m,u]=(0,t.useState)({}),[x,h]=(0,t.useState)(null),[p,g]=(0,t.useState)(null),f=(e,a)=>{if(d(r=>({...r,[e]:a})),m[e]&&u(a=>({...a,[e]:""})),"country"===e&&a){let e=o.od[a];e&&d(a=>({...a,currency:e.currency}))}},b=()=>{let e={};if(c.emisorName.trim()||(e.emisorName="Nombre del emisor es requerido"),c.country||(e.country="Pa\xeds es requerido"),c.period||(e.period="Per\xedodo es requerido"),c.amount.trim()){let a=parseFloat(c.amount);(isNaN(a)||a<=0)&&(e.amount="Monto debe ser un n\xfamero v\xe1lido mayor a 0")}else e.amount="Monto es requerido";return c.currency||(e.currency="Moneda es requerida"),c.period&&!/^\d{4}-\d{2}$/.test(c.period)&&(e.period="Per\xedodo debe estar en formato YYYY-MM"),u(e),0===Object.keys(e).length},j=c.country?o.od[c.country]:null,y=j?j.factor:"";return(0,s.jsxs)(n.Zb,{className:"max-w-3xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Nueva Calificaci\xf3n Tributaria"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Registra una nueva calificaci\xf3n en el contenedor tributario"})]}),(0,s.jsxs)("form",{onSubmit:a=>{a.preventDefault(),b()&&null!==x&&e({...c,calculatedValue:x})},className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Emisor *"}),s.jsx(i.I,{value:c.emisorName,onChange:e=>f("emisorName",e.target.value),error:m.emisorName,placeholder:"Ej: Empresa S.A."})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ID Tributario"}),s.jsx(i.I,{value:c.taxId,onChange:e=>f("taxId",e.target.value),error:m.taxId,placeholder:"Ej: 76.123.456-7"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pa\xeds *"}),(0,s.jsxs)("select",{value:c.country,onChange:e=>f("country",e.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${m.country?"border-red-500":"border-gray-300"}`,children:[s.jsx("option",{value:"",children:"Seleccionar pa\xeds"}),Object.values(o.od).map(e=>(0,s.jsxs)("option",{value:e.code,children:[e.flag," ",e.name]},e.code))]}),m.country&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.country})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per\xedodo *"}),(0,s.jsxs)("select",{value:c.period,onChange:e=>f("period",e.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${m.period?"border-red-500":"border-gray-300"}`,children:[s.jsx("option",{value:"",children:"Seleccionar per\xedodo"}),(()=>{let e=[],a=new Date;for(let r=0;r<12;r++){let s=new Date(a.getFullYear(),a.getMonth()-r,1),t=s.getFullYear(),l=(s.getMonth()+1).toString().padStart(2,"0");e.push(`${t}-${l}`)}return e})().map(e=>s.jsx("option",{value:e,children:e},e))]}),m.period&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.period})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monto *"}),s.jsx(i.I,{type:"number",step:"0.01",min:"0",value:c.amount,onChange:e=>f("amount",e.target.value),error:m.amount,placeholder:"0.00"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Moneda *"}),s.jsx(i.I,{value:c.currency,onChange:e=>f("currency",e.target.value),error:m.currency,placeholder:"USD",disabled:!!j})]})]}),null!==x&&p&&j&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"C\xe1lculo Autom\xe1tico"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-blue-700",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Monto:"}),(0,s.jsxs)("span",{className:"font-medium",children:[parseFloat(c.amount).toLocaleString()," ",c.currency]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:["Factor ",y," (",j.name,"):"]}),s.jsx("span",{className:"font-medium",children:p.toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex justify-between border-t border-blue-300 pt-2",children:[s.jsx("span",{className:"font-medium",children:"Valor Calculado:"}),(0,s.jsxs)("span",{className:"font-bold",children:[x.toFixed(6)," ",y]})]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observaciones"}),s.jsx("textarea",{value:c.observations,onChange:e=>f("observations",e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Comentarios adicionales sobre la calificaci\xf3n..."})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL del Documento"}),s.jsx(i.I,{type:"url",value:c.documentUrl,onChange:e=>f("documentUrl",e.target.value),placeholder:"https://..."})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[s.jsx(l.z,{type:"button",variant:"secondary",onClick:a,disabled:r,children:"Cancelar"}),s.jsx(l.z,{type:"submit",disabled:r||null===x,children:r?"Creando...":"Crear Calificaci\xf3n"})]})]})]})}function u(){let[e,a]=(0,t.useState)([]),[r,l]=(0,t.useState)(!0),[i,n]=(0,t.useState)(!1),[o,c]=(0,t.useState)(null),[u,x]=(0,t.useState)(!1),h=async()=>{try{l(!0);let e=await fetch("/api/qualifications"),r=await e.json();r.success?a(r.data):console.error("Error fetching qualifications:",r.error)}catch(e){console.error("Error fetching qualifications:",e)}finally{l(!1)}},p=async e=>{if(window.confirm(`\xbfEst\xe1s seguro de que quieres eliminar la calificaci\xf3n de "${e.emisorName}"?`))try{let a=await fetch(`/api/qualifications/${e.id}`,{method:"DELETE"}),r=await a.json();r.success?await h():alert("Error al eliminar la calificaci\xf3n: "+r.error)}catch(e){console.error("Error deleting qualification:",e),alert("Error al eliminar la calificaci\xf3n")}},g=async e=>{if(window.confirm(`\xbfAprobar la calificaci\xf3n de "${e.emisorName}"?`))try{let a=await fetch(`/api/qualifications/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"APPROVED"})}),r=await a.json();r.success?await h():alert("Error al aprobar la calificaci\xf3n: "+r.error)}catch(e){console.error("Error approving qualification:",e),alert("Error al aprobar la calificaci\xf3n")}},f=async e=>{let a=window.prompt("Motivo del rechazo:");if(a)try{let r=await fetch(`/api/qualifications/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"REJECTED",rejectionReason:a})}),s=await r.json();s.success?await h():alert("Error al rechazar la calificaci\xf3n: "+s.error)}catch(e){console.error("Error rejecting qualification:",e),alert("Error al rechazar la calificaci\xf3n")}},b=async e=>{try{x(!0);let a={...e,userId:"admin-setup-001"},r=o?`/api/qualifications/${o.id}`:"/api/qualifications",s=await fetch(r,{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await s.json();t.success?(n(!1),c(null),await h()):alert("Error al guardar la calificaci\xf3n: "+t.error)}catch(e){console.error("Error submitting form:",e),alert("Error al guardar la calificaci\xf3n")}finally{x(!1)}};return i?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx(m,{onSubmit:b,onCancel:()=>{n(!1),c(null)},isLoading:u})}):s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx(d,{qualifications:e,onAddNew:()=>{c(null),n(!0)},onView:e=>{console.log("View qualification:",e)},onEdit:e=>{c(e),n(!0)},onDelete:p,onApprove:g,onReject:f,isLoading:r})})}},7270:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\w10\Documents\GitHub\ReponedorNUAM\frontend\src\app\qualifications\page.tsx#default`)}};var a=require("../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),s=a.X(0,[276,400,979],()=>r(524));module.exports=s})();